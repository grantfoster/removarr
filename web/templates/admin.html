{{ define "title" }}Admin Panel - removarr{{ end }}

{{ define "admin_content" }}
<div class="space-y-6">
    <div class="flex justify-between items-center">
        <h1 class="text-3xl font-bold text-gray-100">Admin Panel</h1>
        <div class="flex space-x-2">
            <a href="/dashboard" class="bg-gray-700 text-white px-4 py-2 rounded-md hover:bg-gray-600">Back to Dashboard</a>
            <button onclick="showCreateUserModal()" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700">Create User</button>
        </div>
    </div>

    <!-- Users Section -->
    <div class="bg-gray-800 rounded-lg shadow-lg border border-gray-700">
        <div class="px-6 py-4 border-b border-gray-700">
            <h2 class="text-xl font-semibold text-gray-100">Users</h2>
        </div>
        <div id="users-list" class="p-6">
            <div class="text-center text-gray-400">Loading users...</div>
        </div>
    </div>

    <!-- Settings Section -->
    <div class="bg-gray-800 rounded-lg shadow-lg border border-gray-700">
        <div class="px-6 py-4 border-b border-gray-700">
            <h2 class="text-xl font-semibold text-gray-100">Settings</h2>
        </div>
        <div class="p-6">
            <a href="/admin/settings" class="text-indigo-400 hover:text-indigo-300 underline">Manage Settings</a>
        </div>
    </div>
</div>

<!-- Create User Modal -->
<div id="create-user-modal" class="fixed inset-0 bg-black bg-opacity-75 hidden z-50 flex items-center justify-center">
    <div class="bg-gray-800 rounded-lg shadow-xl max-w-md w-full mx-4 border border-gray-700">
        <div class="p-6">
            <h3 class="text-lg font-semibold text-gray-100 mb-4">Create User</h3>
            <form id="create-user-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-1">Username</label>
                    <input type="text" name="username" required
                           class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-1">Email (Optional)</label>
                    <input type="email" name="email"
                           class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-1">Password</label>
                    <input type="password" name="password" required
                           class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <div>
                    <label class="flex items-center">
                        <input type="checkbox" name="is_admin" class="rounded border-gray-600 bg-gray-700">
                        <span class="ml-2 text-sm text-gray-300">Admin</span>
                    </label>
                </div>
                <div class="flex justify-end space-x-3">
                    <button type="button" onclick="hideCreateUserModal()"
                            class="px-4 py-2 text-gray-300 bg-gray-700 rounded-md hover:bg-gray-600">
                        Cancel
                    </button>
                    <button type="submit"
                            class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">
                        Create
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{{ end }}

{{ define "content" }}
{{ template "admin_content" . }}
{{ end }}

{{ define "scripts" }}
<script>
// Load users on page load
document.addEventListener('DOMContentLoaded', loadUsers);

function loadUsers() {
    fetch('/api/admin/users')
        .then(res => res.json())
        .then(users => {
            const listDiv = document.getElementById('users-list');
            if (users.length === 0) {
                listDiv.innerHTML = '<div class="text-center text-gray-400">No users found</div>';
                return;
            }
            
            listDiv.innerHTML = `
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-700">
                        <thead class="bg-gray-700">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Username</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Email</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Admin</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Active</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="bg-gray-800 divide-y divide-gray-700">
                            ${users.map(user => `
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-100">${escapeHtml(user.username)}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">${user.email || '-'}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">${user.is_admin ? '✓' : ''}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">${user.is_active ? '✓' : '✗'}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <button onclick="editUser(${user.id})" class="text-indigo-400 hover:text-indigo-300 mr-3">Edit</button>
                                        <button onclick="deleteUser(${user.id})" class="text-red-400 hover:text-red-300">Delete</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        })
        .catch(err => {
            document.getElementById('users-list').innerHTML = '<div class="text-center text-red-400">Error loading users</div>';
        });
}

function showCreateUserModal() {
    document.getElementById('create-user-modal').classList.remove('hidden');
    document.getElementById('create-user-form').reset();
}

function hideCreateUserModal() {
    document.getElementById('create-user-modal').classList.add('hidden');
}

document.getElementById('create-user-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    const formData = new FormData(e.target);
    const data = {
        username: formData.get('username'),
        email: formData.get('email'),
        password: formData.get('password'),
        is_admin: formData.get('is_admin') === 'on'
    };
    
    const response = await fetch('/api/admin/users', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
    });
    
    if (response.ok) {
        hideCreateUserModal();
        loadUsers();
    } else {
        alert('Failed to create user');
    }
});

function editUser(id) {
    // TODO: Implement edit user modal
    alert('Edit user ' + id + ' - TODO');
}

function deleteUser(id) {
    if (!confirm('Are you sure you want to delete this user?')) return;
    
    fetch(`/api/admin/users/${id}`, { method: 'DELETE' })
        .then(res => {
            if (res.ok) {
                loadUsers();
            } else {
                alert('Failed to delete user');
            }
        });
}

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}
</script>
{{ end }}

